<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Resultado del Modelo</title>
    <!-- Tema de Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.1.3/dist/flatly/bootstrap.min.css" />
    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
</head>
<body class="p-4">
    <!-- Contenedor principal de resultados -->
    <div class="container container-box">
        <h1>Modelo seleccionado: {{ model_name }}</h1>
        <h3 class="mt-4">Series de valores</h3>
        <p><strong>Entrenamiento:</strong> {{ train_display }}</p>
        <p><strong>Reales (test):</strong> {{ test_display }}</p>
        <p><strong>Pronosticados:</strong> {{ pred_display }}</p>
        <p><strong>Residuales:</strong> {{ resid_display }}</p>
        <!-- Canvas donde se dibujará el gráfico con Chart.js -->
        <canvas id="chart" height="100"></canvas>
        <!-- Formulario para descargar los datos en Excel -->
        <form method="POST" action="{{ url_for('download_excel') }}" class="mt-3">
            <input type="hidden" name="model_name" value="{{ model_name }}" />
            <input type="hidden" name="train_series" value='{{ train_series|tojson }}' />
            <input type="hidden" name="test_series" value='{{ test_series|tojson }}' />
            <input type="hidden" name="pred_series" value='{{ pred_series|tojson }}' />
            <input type="hidden" name="resid_series" value='{{ resid_series|tojson }}' />
            <input type="hidden" name="ci_lower" value='{{ ci_lower|tojson }}' />
            <input type="hidden" name="ci_upper" value='{{ ci_upper|tojson }}' />
            <input type="hidden" name="dates" value='{{ dates|tojson }}' />
            <button type="submit" class="btn btn-primary">Guardar en Excel</button>
        </form>
    </div>
    <!-- Bibliotecas JavaScript y script para dibujar el gráfico -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const labels = {{ dates|tojson }};
        const train = {{ train_series|tojson }};
        const testReal = {{ test_series|tojson }};
        const testPred = {{ pred_series|tojson }};
        const resid = {{ resid_series|tojson }};
        const ciLow = {{ ci_lower|tojson }};
        const ciHigh = {{ ci_upper|tojson }};

        // Configura y renderiza el gráfico de líneas con las series y bandas de confianza
        new Chart(document.getElementById('chart'), {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {label: 'Entrenamiento', data: train, borderColor: 'blue', fill:false},
                    {label: 'Real (test)', data: testReal, borderColor: 'green', fill:false},
                    {label: 'Pronóstico', data: testPred, borderColor: 'red', fill:false},
                    {label: 'Residual', data: resid, borderColor: 'purple', fill:false, yAxisID: 'y1'},
                    {label: 'CI inferior', data: ciLow, borderColor: 'rgba(255,0,0,0.3)', fill:false},
                    {label: 'CI superior', data: ciHigh, borderColor: 'rgba(255,0,0,0.3)', fill:false}
                ]
            },
            options: {
                scales: {
                    y: {position: 'left'},
                    y1: {position: 'right', grid: {drawOnChartArea: false}}
                }
            }
        });
    </script>
</body>
</html>
